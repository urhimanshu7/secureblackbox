<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register - Secure File Storage</title>
  <style>
     * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: rgb(78, 142, 153);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      width: 100%;
      flex-direction: column;
    }

    .hanger-row {
      display:flex;
      justify-content: space-between;
      width: 100%;
      padding: 0px 100px;
      position: relative;
    }

    .hanger {
      margin-top: -60px;
      padding-top: 0px;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: swing 1.5s infinite ease-in-out;
      transform-origin: top center;
    }

    .rope {
      width: 4px;
      height: 250px;
      background-color: #333;
    }

    .rope2 {
      width: 4px;
      height: 250px;
      background-color: #333;
    }

    .text {
      background: #20c997;
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      font-size: 18px;
      font-weight: bold;
      margin-top: 0px;
    }

    @keyframes swing {
      0% { transform: rotate(2deg); }
      50% { transform: rotate(-2deg); }
      100% { transform: rotate(2deg); }
    }

    .box {
      width: 100%;
      max-width: 300px;
      padding: 60px 140px;
      background: rgb(45, 100, 148);
      border: 3px solid #444;
      border-radius: 10px;
      position: relative;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0 auto;
      margin-top: 50px;
      transform: translateX(-50px);
    }

    .file {
      width: 60px;
      height: 80px;
      background: white;
      border: 2px solid #999;
      border-radius: 5px;
      position: absolute;
      top: 90px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      font-weight: bold;
      animation: dropFile 2s infinite;
    }

    @keyframes dropFile {
      0% {
        top: -90px;
        opacity: 0;
      }
      60% {
        top: 60px;
        opacity: 1;
      }
      100% {
        top: 110px;
        opacity: 0;
      }
    }

    .wrapper {
      position: relative;
      width: 600px;
      height: 250px;
      margin-bottom: 0px;
    }

    .lock {
      position: absolute;
      top: -12px;
      left: 41%;
      transform: translateX(-10px);
      font-size: 50px;
      transition: transform 0s ease;
      z-index: 10;
    }

    .locked {
      transform: translate(-30px,80px);
    }

    .text1 {
      text-align: center;
      margin-top: 30px;
      font-size: 18px;
      color: white;
      transform: translateX(-50px);
    }

    form {
      background-color: #aeb28c;
      padding: 35px 70px;
      border-radius: 55px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 500px;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }

    input[type="email"],
    input[type="password"] {
      width: 404px;
      padding: 14px 20px;
      margin: 15px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      transition: 0.3s;
      transform: translateX(-20px);
    }

    button {
      width: 404px;
      padding: 14px;
      background-color: #5a4a9a;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      margin-top: -10px;
      transform: translateX(-20px);
    }

    button:hover {
      background-color: #260371;
    }
    .password-container {
    position: relative;
    width: 404px;
    margin: 15px 0;
    transform: translateX(-10px);
  }

  .password-container input {
    width: 100%;
    padding: 14px 40px 14px 20px; /* Right padding for eye icon */
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 16px;
  }

  .toggle-eye {
    position: fixed;
    right: 12px;
    top: 35%;
    transform: translateX(-40%);
    cursor: pointer;
    font-size: 18px;
    color: #555;
  }
  </style>
</head>
<body>
<div class="hanger-row">
    <div class="hanger">
      <div class="rope"></div>
      <div class="text" style="font-size: 45px; background-color: #333; color: white;">
        R<span style="color: rgb(41, 72, 144);">E</span>G<span style="color: rgb(80, 93, 124);">I</span>S<span style="color: rgb(187, 72, 46);">T</span>E<span style="color: rgb(138, 159, 89);">R</span>
      </div>
    </div>

    <div class="wrapper">
        <div class="lock" id="lock">üîì</div>
        <div class="box">
          <div class="file" id="file" style="font-size: 40px;">üìÑ</div>
        </div>
        <div class="text1" style="font-size: 33px; color: #486a85;">Your data will be secure here.</div>
    </div>

    <div class="hanger">
      <div class="rope2"></div>
      <div class="text" style="font-size: 45px; background-color: rgb(124, 10, 105); color: white;">
        H<span style="color: rgb(32, 49, 80);">E</span>R<span style="color: rgb(167, 127, 17);">E</span>
      </div>
    </div>
</div>

<form id="registerForm">
  <h2>Register Your Account</h2>
  <input type="email" name="email" placeholder="Enter your Email" autocomplete="off" required />
  <span id="email-status" style="font-size:14px; display:block; margin-top:5px;"></span>
  <br>
  <div class="password-container">
    <input type="password" name="password" placeholder="Password >=7 Letters" autocomplete="new-password" required />
    <span class="toggle-eye" onclick="togglePassword(this)">üëÅ</span>
  </div>

  <!-- 2FA Password with eye -->
  <div class="password-container">
    <input type="password" name="twoFactorPassword" placeholder="2FA Password >=7 Letters" autocomplete="new-password" required />
    <span class="toggle-eye" onclick="togglePassword(this)">üëÅ</span>
  </div>
  <input type="email" name="otpEmail" placeholder="Enter your Email For OTP Verification" autocomplete="off" required />
<span id="alt-email-status" style="font-size:14px; display:block; margin-top:5px;"></span>
<br>

  <button type="submit">Register</button>
</form>

<script>
  // Lock animation
  setTimeout(() => {
    document.getElementById("lock").textContent = "üîí";
    document.getElementById("lock").classList.add("locked");
  }, 1000);
</script>
<script>
  function togglePassword(el) {
    const input = el.previousElementSibling;
    if (input.type === "password") {
      input.type = "text";
      el.textContent = "üôà"; // change icon when visible
    } else {
      input.type = "password";
      el.textContent = "üëÅ"; // change back to eye
    }
  }
</script>

<script>
  // Live email check
  document.querySelector('input[name="email"]').addEventListener('input', async (e) => {
    const email = e.target.value;
    const statusEl = document.getElementById('email-status');

    if (!email) {
      statusEl.textContent = '';
      return;
    }

    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!regex.test(email)) {
      statusEl.textContent = '‚ùå Invalid email format';
      statusEl.style.color = 'red';
      return;
    }

    try {
      const res = await fetch(`https://YOUR-RENDER-URL/check-email?email=${encodeURIComponent(email)}`);
      const data = await res.json();

      if (res.ok && data.available) {
        statusEl.textContent = '‚úÖ Email is available';
        statusEl.style.color = 'green';
      } else {
        statusEl.textContent = '‚ùå Email is already registered';
        statusEl.style.color = 'red';
      }
    } catch (err) {
      statusEl.textContent = '‚ö†Ô∏è Could not verify email';
      statusEl.style.color = 'orange';
    }
  });

  // Form submit
  document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = e.target.email.value;
    const password = e.target.password.value;
    const twoFactorPassword = e.target.twoFactorPassword.value;
    const otpEmail = e.target.otpEmail.value; // ‚úÖ FIX: Get altEmail value

    if (password.length < 7) {
      alert("Password must be at least 7 characters long.");
      return;
    }

    if (twoFactorPassword.length < 7) {
      alert("2FA Password must be at least 7 characters long.");
      return;
    }

    const res = await fetch('http://localhost:5000/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, otpEmail, password, twoFactorPassword })
    });

    const data = await res.json();
    alert(data.message || data.error);

    if (res.ok) {
      // ‚úÖ Store altEmail so OTP page can use it
      sessionStorage.setItem("otpEmail", otpEmail);
      window.location.href = '/login.html';
    }
  });
</script>


</body>
</html>

